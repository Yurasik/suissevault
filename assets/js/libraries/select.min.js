(function ($){$.fn.knotSelect=function(){return this.hide(),this.each((function(){var s=$(this);s.next().hasClass("select")||function(s){s.after('<div class="current"></div><div class="select_dropdown"><ul></ul></div>');var e=s.siblings(".current").attr("tabindex","0"),t=s.siblings(".select_dropdown"),i=s.find("option"),l=s.find("option:selected");e.html(l.data("display")||l.text()),i.each((function(){var s=$(this),e=s.data("display");"hidden"!=s.val()&&t.find("ul").append($("<li></li>").attr("data-value",s.val()).attr("data-display",e||null).addClass((s.is(":selected")?" selected":"")+(s.is(":disabled")?" disabled":"")).html(s.text()))}))}(s)})),$(document).on("click",".current, .select_dropdown",(function(s){var e=$(this).hasClass("current")?$(this).siblings(".select_dropdown"):$(this);$(".select_dropdown").not(e).removeClass("active last").siblings(".current").removeClass("active"),e.toggleClass("active").addClass("last").siblings(".current").toggleClass("active"),e.hasClass("active")?(e.find(".focus").removeClass("focus"),e.find(".selected").addClass("focus")):e.focus()})),$(document).on("click",(function(s){0===$(s.target).closest(".select").length&&$(".select_dropdown, .current").removeClass("active")})),$(document).on("click",".select_dropdown li:not(.disabled)",(function(s){var e=$(this),t=e.closest(".select_dropdown");t.find(".selected").removeClass("selected"),e.addClass("selected");var i=e.data("display")||e.text();t.siblings(".current").text(i),t.siblings("select").val(e.data("value")).trigger("change")})),$(document).on("mouseenter",".select_dropdown li",(function(s){$(this).addClass("focus").siblings().removeClass("focus")})),$(document).on("keydown","body",(function(s){var e=$(".select_dropdown.last"),t=$(e.find(".focus")||e.find("li.selected"));if($(".select .current").is(":focus")){if(32==s.keyCode||13==s.keyCode)return e.hasClass("active")?t.trigger("click"):e.trigger("click"),!1;if(40==s.keyCode){if(e.hasClass("active")){var i=t.nextAll("li:not(.disabled)").first();i.length>0&&(e.find(".focus").removeClass("focus"),i.addClass("focus"),i.position().top>=e.height()/2&&e.find("ul").animate({scrollTop:i.position().top},230))}return!1}if(38==s.keyCode){if(e.hasClass("active")){var l=t.prevAll("li:not(.disabled)").first();l.length>0&&(e.find(".focus").removeClass("focus"),l.addClass("focus"),l.position().top<=e.height()/2&&e.find("ul").animate({scrollTop:l.position().top+l.height()},230))}return!1}27==s.keyCode&&e.hasClass("active")&&e.trigger("click")}9==s.keyCode&&setTimeout((function(){$(".select .current").each((function(){if($(this).is(":focus")){var s=$(this).hasClass("current")?$(this).siblings(".select_dropdown"):$(this);$(".select_dropdown").not(s).removeClass("last"),s.addClass("last"),s.hasClass("active")?(s.find(".focus").removeClass("focus"),s.find(".selected").addClass("focus")):s.focus()}else $(".select_dropdown, .current").removeClass("active")}))}),10)})),!1}}(jQuery));